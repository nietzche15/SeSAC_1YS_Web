<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <title>회원가입</title>
    <script>
        function idCheck(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/sign/',
                data : { id : form.id.value }
                }).then((response)=>{
                    console.log('response.data : ', response.data);

                    if (response.data==true){
                        alert('사용 중인 ID 입니다.');
                        form.id.value="";
                    }else{ 
                        alert('사용 가능한 ID 입니다.');
                        $('.idCheck_btn').addClass('d_none');
                    }
                })
            };
    </script>
    <style>
        .d_none {display: none;}
    </style>
</head>
<body>
    <form id="form_info">
        <fieldset style="display: inline-block;">
            <legend>Welcome</legend>
            <input type="hidden" id="reset_sign">
            
            ID : <input type="text" name="id" id="id"><br>
            
            <div class="idCheck_btn">
                <button type="button" onclick="idCheck();">ID 중복 확인</button>
            </div>
            Password : <input type="password" name="pw"><br>
            <div class="name_input">
            Name : <input type="text" name="name"><br>
            </div>
            <div class="signUp_btn">
                <button type="button" onclick="signUp();">Sign Up</button>
            </div>
            <div class="signIn_btn d_none">
                <button type="button" onclick="signIn();">Sign In</button>
            </div> 
            <div class="removeInfo_btn d_none">
                <button type="button" onclick="deleteInfo();">회원탈퇴</button>
            </div> 
        </fieldset>
    </form>
    
    <script>
        
        function signUp(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/sign/signUp/',
                data : {
                    id : form.id.value,
                    pw : form.pw.value,
                    name : form.name.value,
                }
            }).then((response)=>{
                 form.pw.value = "";
                    $('.name_input').addClass('d_none');
                    $('.signUp_btn').addClass('d_none');
                    $('.signIn_btn').removeClass('d_none');
                    alert('회원가입이 완료되었습니다. 다시 로그인해주세요!');
            })
        }

        function signIn(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/sign/signIn/',
                data : {
                    id : form.id.value,
                    pw : form.pw.value,
                }
            }).then((response)=>{
                console.log('response : ', response.data );
                if( form.pw.value == response.data.pw ){ myInfo();}
                else{ alert('ID와 Password를 다시 확인해주세요'); }
            })
        }

        function myInfo(){
            var form = document.getElementById('form_info');
            $('.name_input').removeClass('d_none');
            $('#id').attr('readonly',true);
            $('.signIn_btn').addClass('d_none');
            $('.removeInfo_btn').removeClass('d_none'); 
            $('legend').text('My Information');
        }

        function deleteInfo(){
            var form = document.getElementById('form_info');
            axios({
                method : 'delete',
                url : '/sign/deleteInfo/',
                data : { id : form.id.value },
            }).then((response)=>{
                alert('회원탈퇴가 완료되었습니다.');

                $('form').remove();

                let link ="/sign/";

                $('body').html('<%-"<a href=link>처음으로 돌아가기</a>"%>');
            })
        }

    </script>
</body>
</html>