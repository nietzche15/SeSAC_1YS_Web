<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <title>회원가입</title>
    <script>
        function idCheck(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/signIn/signUp',
                data : { id : form.id.value }
                }).then((response)=>{
                    console.log('response.data : ', response.data);

                    if (response.data==true){
                        alert('사용 중인 ID 입니다.');
                        form.id.value="";
                    }else{ 
                        alert('사용 가능한 ID 입니다.');
                        $('.idCheck_btn').addClass('d_none');
                    }
                })
            };
    </script>
    <style>
        * {font-family: 'Times New Roman', Times, serif;}

        .d_none {display: none;}
        fieldset { display : flex; flex-direction: column; justify-content: center; align-items: center;
                width : 500px; border-radius: 10px; background-color: azure;}
        div {width : 350px; margin-top: 10px; text-align: center;}
    </style>
</head>
<body>
    <form id="form_info">
        <fieldset>
            <legend>Welcome</legend>
            <input type="hidden" id="reset_sign">
            
            <div>
                ID : <input type="text" name="id" id="id">
            </div>
            
            <div class="idCheck_btn d_none">
                <button type="button" onclick="idCheck();">ID 중복 확인</button>
            </div>
            <div>
                Password : <input type="password" name="pw"><br>
            </div>
            <div class="name_input d_none">
                Name : <input type="text" name="name"><br>
            </div>
            <div class="signIn_btn">
                <button type="button" onclick="signIn();">Sign In</button>
            </div> 
            <div class="goSignup_btn">
                <button type="button" onclick="goSignup();">Go to sign up</button>
            </div>
            <div class="signUp_btn d_none">
                <button type="button" onclick="signUp();">Sign Up</button>
            </div>
            <div class="updateInfo_btn d_none">
                <button type="button" onclick="updateInfo();">수정</button>
            </div> 
            <div class="deleteInfo_btn d_none">
                <button type="button" onclick="checkInfo();">회원탈퇴</button>
            </div> 
        </fieldset>
    </form>
    
    <script>
        function signIn(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/signIn/',
                data : { id : form.id.value },
            }).then((response)=>{
                console.log('response.data : ', response.data );
                if( response.data.length < 1 ){ 
                    alert('존재하지 않는 ID입니다. 회원가입 후 이용해주세요.');
                }else if( form.pw.value == response.data.pw ){ 
                    form.name.value = response.data.name;
                    myInfo();}
                else{ alert('ID와 Password를 다시 확인해주세요'); }
            })
        }

        function goSignup(){
            $('.signIn_btn').addClass('d_none');
            $('.goSignup_btn').addClass('d_none');

            $('.name_input').removeClass('d_none');
            $('.idCheck_btn').removeClass('d_none');
            $('.signUp_btn').removeClass('d_none');
        }

        function signUp(){
            var form = document.getElementById('form_info');
            axios({
                method : 'post',
                url : '/signIn/signUp/',
                data : {
                    id : form.id.value,
                    pw : form.pw.value,
                    name : form.name.value,
                }
            }).then((response)=>{
                form.id.value = "";
                form.pw.value = "";

                $('.name_input').addClass('d_none');
                $('.signUp_btn').addClass('d_none');
                $('.signIn_btn').removeClass('d_none');
                $('.goSignup_btn').removeClass('d_none');
                alert('회원가입이 완료되었습니다. 다시 로그인해주세요!');
            })
        }

        function myInfo(){
            $('#id').attr('readonly',true);
            $('.signIn_btn').addClass('d_none');
            $('.goSignup_btn').addClass('d_none');

            $('.name_input').removeClass('d_none');
            $('.updateInfo_btn').removeClass('d_none'); 
            $('.deleteInfo_btn').removeClass('d_none'); 

            $('legend').text('My Information');
        }

        function checkInfo(){
            var form = document.getElementById('form_info');
            axios({
                method : 'get',
                url : '/signIn/deleteInfo/',
                params : { id : form.id.value },
            }).then((response)=>{
                console.log( 'response : ', response );
                console.log( 'response.data : ', response.data );
                if( form.pw.value==response.data.pw && form.name.value==response.data.name ){ deleteInfo(); }
                else{ 
                    alert('Password와 Name을 다시 확인해주세요.');}
            })
        }

        function deleteInfo(){
            var form = document.getElementById('form_info');
            axios({
                method : 'delete',
                url : '/signIn/deleteInfo/',
                data : { id : form.id.value },
            }).then((response)=>{
                if(response) {alert('회원탈퇴가 완료되었습니다.');}

                $('form').remove();

                let link ="/sign/";
                $('body').html('<a href=' + link + '>처음으로 돌아가기</a>' );
            })
        }

        function updateInfo(){
            var form = document.getElementById('form_info');
            axios({
                method : 'patch',
                url : '/signIn/updateInfo/',
                data : {
                    id : form.id.value,
                    pw : form.pw.value,
                    name : form.name.value,
                },
            }).then((response)=>{
                form.id.value = "";
                form.pw.value = "";

                $('#id').removeAttr('readonly');
                $('.signIn_btn').removeClass('d_none');
                $('.goSIgnup_btn').removeClass('d_none');


                $('.name_input').addClass('d_none');
                $('.updateInfo_btn').addClass('d_none'); 
                $('.deleteInfo_btn').addClass('d_none'); 

                $('legend').text('Welcome');
                alert('회원정보가 수정되었습니다. 다시 로그인해주세요.');
            })
        }

    </script>
</body>
</html>